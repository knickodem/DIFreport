---
author: "PFH & KKN" 
output:
html_document:
    toc: yes
    always_allow_html: yes
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(options(knitr.kable.NA = ''))


library(knitr)
library(rmarkdown)
library(kableExtra)

```

---
title: "`r paste0(Measure_Name, ": ", Assessment_Name, " Report")`"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
---


# Summary


Dataset: `r Measure_Name`

Outcome variable: `r paste0(Assessment_Name,  " (", item_name_range, ")")`

Grouping variable: `r paste0(Comparison_Name, " (", grouping_levs, ")")`

Bias detection method: `r paste(bias_method, "using", DIF_Results$Inputs$scoreType, "scores")`

Total number of biased items: `r paste(n_biased, "out of", n_items)`

Type of item bias: `r bias_type`

  
```{r direction}
if(bias_method == "MH"){
  
  cat("Number of items uniformly biased toward [level1]:", toward1)
  cat("\n\n")
  cat("Number of items uniformly biased toward [level2]:", toward2)
  
}
```
  

```{r Summary Table}

if(is.null(conditional)){
  
  cat("## Unconditional")
  cat("\n\n")
  cat("Summary table for robustness of unconditional treatment effects") #(comparing `r Tx$Comparison`)) 
  cat("\n\n")
  
  kable(UnconditionalEffects$Effects_Table, digits = 2)
} else {
  
  cat("## Conditional")
  
  # Summary table for robustness of conditional treatment effects for `r levels(NumberRecog$CondVector)[[1]]` (comparing `r Tx$Comparison`)
  # 
  # kable(ConditionalEffects1$Effects_Table, digits = 2)
  # 
  # Summary table for robustness of conditional treatment effects for `r levels(NumberRecog$CondVector)[[2]]` (comparing `r Tx$Comparison`)
  # 
  # kable(ConditionalEffects2$Effects_Table, digits = 2)
}

```





# Comparing Bias Detection Methods

## Descriptive analyis via Loess

```{r loess}
print(DIF_Results$loess$plot)
```


## Mantel-Haenszel

```{r MH}
kable(DIF_Results$MH$Item, digits = 2)
```

## Logistic Regression

#### Global Comparison

```{r Logistic Global}
kable(DIF_Results$logistic$Global, digits = 2)
```

#### Item-level

```{r Logistic Item}
kable(DIF_Results$logistic$Item, digits = 2)
```

## Item Response Theory


#### Global Comparison

```{r IRT Global}
kable(DIF_Results$IRT$Global, digits = 2, row.names = FALSE)
```

#### Item-level

```{r IRT Item}
kable(DIF_Results$IRT$Item, digits = 2)
```